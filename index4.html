<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ì‹œê³„ ê³µë¶€</title>
    <style>
      :root {
        --bg: #0b0c10;
        --card: #101218;
        --ink: #e9ecff;
        --muted: #a7adcf;
        --line: #24283a;
        --brand: #7c4dff;
        --ok: #27ae60;
        --bad: #ff5a5a;
      }
      * { box-sizing: border-box }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--ink);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      }
      .container { max-width: 980px; margin: 0 auto; padding: 18px 14px }
      header {
        position: sticky; top: 0;
        background: rgba(11,12,16,.7);
        backdrop-filter: blur(8px);
        border-bottom: 1px solid var(--line);
        z-index: 10;
      }
      .bar { max-width: 980px; margin: 0 auto; display: flex; align-items: center; gap: 10px; padding: 12px 14px }
      .title { font-weight: 700 }
      .pill { border: 1px solid var(--line); background: var(--card); border-radius: 999px; padding: 8px 12px }
      .row { display: flex; gap: 14px; flex-wrap: wrap }
      .card { background: var(--card); border: 1px solid var(--line); border-radius: 16px; padding: 14px }
      .grow { flex: 1 1 320px }
      .controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; margin: 6px 0 10px }
      select, button, input {
        background: #0f0f14; border: 1px solid var(--line); color: var(--ink); padding: 10px 12px; border-radius: 10px
      }
      button { cursor: pointer }
      button.primary { border-color: var(--brand) }
      button.ok { background: var(--ok); border-color: var(--ok); color: #fff }
      button.bad { background: var(--bad); border-color: var(--bad); color: #fff }
      .hint { color: var(--muted); font-size: .95rem }
      .big { font-size: 1.3rem }
      .score { display: flex; gap: 10px; align-items: center }
      .score .badge { border: 1px solid var(--line); border-radius: 10px; padding: 6px 10px }
      .result { margin-top: 8px; font-weight: 700 }
      .result.ok { color: var(--ok) }
      .result.bad { color: var(--bad) }
      .clock-wrap { display: flex; justify-content: center; align-items: center; padding: 10px }
      svg { max-width: 420px; width: 100%; height: auto }
      .legend { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; justify-content: center; margin-top: 8px }
      .dot { width: 10px; height: 10px; border-radius: 50% }
      .dot.min { background: #9ad0ff }
      .dot.hour { background: #ffd480 }
      .sr-only { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden }
      .footer { color: var(--muted); font-size: .9rem; margin-top: 14px }
    /* ëª¨ë°”ì¼ ë“œë˜ê·¸ ì•ˆì •í™” */
html, body { overscroll-behavior: none; }
.clock-wrap, svg { -webkit-user-select: none; user-select: none; }
#clock, #minuteHand, #hourHand { touch-action: none; } /* í„°ì¹˜ ì œìŠ¤ì²˜(ìŠ¤í¬ë¡¤/ì¤Œ) ì°¨ë‹¨ */

/* ì†ì¡ì´(íˆíŠ¸ì˜ì—­) ì‚´ì§ í™•ëŒ€ â€“ ë³´ì´ì§€ ì•ŠìŒ */
#minuteHand, #hourHand { pointer-events: all; }
#minuteHand .hit, #hourHand .hit { fill: transparent; pointer-events: all; }

    </style>
  </head>
  <body>
    <header>
      <div class="bar">
        <div class="title">ğŸ•’ ì‹œê³„ ê³µë¶€ â€“ ì´ˆ1 ë†€ì´ì•±</div>
        <div class="pill score" style="margin-left:auto">
          <span class="badge">ì •ë‹µ: <strong id="correctCount">0</strong></span>
          <span class="badge">ì—°ì†: <strong id="streak">0</strong></span>
          <span class="badge">ìµœê³ ê¸°ë¡: <strong id="best">0</strong></span>
        </div>
      </div>
    </header>

    <div class="container">
      <div class="row">
        <section class="card grow" aria-labelledby="learn-clock">
          <h2 id="learn-clock" style="margin:6px 0 8px">ì•„ë‚ ë¡œê·¸ ì‹œê³„</h2>
          <div class="clock-wrap">
            <!-- SVG ì‹œê³„ -->
            <svg id="clock" viewBox="0 0 200 200" role="img" aria-label="í•™ìŠµìš© ì‹œê³„">
              <!-- ì™¸ê³½ ì› -->
              <circle cx="100" cy="100" r="94" fill="#0a0b10" stroke="#2c3150" stroke-width="2"></circle>
              <circle cx="100" cy="100" r="92" fill="#0f1119" stroke="#3a406b" stroke-width="1"></circle>

              <!-- ë¶„ì¹¨ g ë‚´ë¶€ ëìª½ì— -->
<circle class="hit" cx="100" cy="36" r="18"></circle>
<!-- ì‹œì¹¨ g ë‚´ë¶€ ëìª½ì— -->
<circle class="hit" cx="100" cy="56" r="18"></circle>

              <!-- ëˆˆê¸ˆ -->
              <g id="ticks"></g>

              <!-- ë¶„ì¹¨ -->
              <g id="minuteHand" transform="rotate(0 100 100)" style="cursor:grab">
                <rect x="99" y="24" width="2" height="76" rx="2" ry="2" fill="#9ad0ff"></rect>
                <circle cx="100" cy="100" r="6" fill="#9ad0ff"></circle>
              </g>

              <!-- ì‹œì¹¨ -->
              <g id="hourHand" transform="rotate(0 100 100)" style="cursor:grab">
                <rect x="98" y="48" width="4" height="52" rx="2" ry="2" fill="#ffd480"></rect>
                <circle cx="100" cy="100" r="6" fill="#ffd480"></circle>
              </g>

              <!-- ì¤‘ì‹¬ -->
              <circle cx="100" cy="100" r="3" fill="#fff"></circle>
            </svg>
          </div>
          <div class="legend">
            <span class="dot min"></span><span class="hint">ë¶„ì¹¨ ë“œë˜ê·¸</span>
            <span class="dot hour"></span><span class="hint">ì‹œì¹¨ ë“œë˜ê·¸</span>
          </div>
          <p class="hint" style="text-align:center">
            ì†ê°€ë½(ëª¨ë°”ì¼)ì´ë‚˜ ë§ˆìš°ìŠ¤ë¡œ ë°”ëŠ˜ì„ ë“œë˜ê·¸í•´ì„œ ì›€ì§ì—¬ ë³´ì„¸ìš”.
          </p>
        </section>

        <section class="card grow" aria-labelledby="game-panel">
          <h2 id="game-panel" style="margin:6px 0 8px">ê²Œì„ íŒ¨ë„</h2>

          <div class="controls">
            <label>ëª¨ë“œ
              <select id="mode">
                <option value="set">ë§ì¶”ê¸°(ì†ìœ¼ë¡œ ë§ì¶”ê¸°)</option>
                <option value="read">ì½ê¸°(ì‹œê°„ ì ê¸°)</option>
              </select>
            </label>
            <label>ë‚œì´ë„
              <select id="difficulty">
                <option value="hour">ì •ì‹œ(00ë¶„)</option>
                <option value="half">30ë¶„</option>
                <option value="ten">10ë¶„ ë‹¨ìœ„</option>
                <option value="five" selected>5ë¶„ ë‹¨ìœ„</option>
                <option value="one">1ë¶„ ë‹¨ìœ„</option>
              </select>
            </label>
            <button id="newQ" class="primary">ìƒˆ ë¬¸ì œ</button>
          </div>

          <div id="panelSet" class="card" style="background:#0d0f16">
            <div class="big">ğŸ¯ ëª©í‘œ ì‹œê°„: <strong id="targetLabel">â€”</strong></div>
            <p class="hint">
              ì•„ë‚ ë¡œê·¸ ì‹œê³„ë¥¼ ë“œë˜ê·¸í•´ ëª©í‘œ ì‹œê°„ê³¼ ë˜‘ê°™ì´ ë§ì¶˜ ë’¤ <em>ì •ë‹µ í™•ì¸</em>ì„ ëˆ„ë¥´ì„¸ìš”.
            </p>
            <div class="controls">
              <button id="checkSet" class="">ì •ë‹µ í™•ì¸</button>
              <button id="showAnswerSet">ì •ë‹µ ë³´ê¸°</button>
              <span id="resultSet" class="result"></span>
            </div>
          </div>

          <div id="panelRead" class="card" style="background:#0d0f16; display:none">
            <div class="big">ğŸ” ì´ ì‹œê³„ëŠ” ëª‡ ì‹œ ëª‡ ë¶„?</div>
            <div class="controls">
              <label>ì‹œ
                <input id="ansHour" type="number" min="1" max="12" inputmode="numeric" style="width:90px" />
              </label>
              <label>ë¶„
                <input id="ansMin" type="number" min="0" max="59" inputmode="numeric" style="width:110px" />
              </label>
              <button id="checkRead">ì •ë‹µ í™•ì¸</button>
              <button id="showAnswerRead">ì •ë‹µ ë³´ê¸°</button>


              <span id="resultRead" class="result"></span>
            </div>
          </div>

         <div class="controls" style="justify-content:center; margin-top:10px">
  <button id="btnReadTime" class="primary">ğŸ—£ï¸ ì§€ê¸ˆ ì‹œê° ì½ê¸°</button>
</div>

          <div class="footer">
            íŒ: ë‚œì´ë„ë¥¼ ì˜¬ë¦¬ë©´(5ë¶„ â†’ 1ë¶„) <strong>ë¶„ì¹¨ ì •ë°€ë„</strong>ê°€ ë†’ì•„ì ¸ìš”.
            ìƒí™œ ì—°ê²° ì§ˆë¬¸ ì˜ˆ) â€œë²„ìŠ¤ ë„ì°© 10ë¶„ ì „ì´ë©´ ë¶„ì¹¨ì´ ì–´ë”” ìˆì„ê¹Œ?â€
          </div>
        </section>
      </div>
    </div>

    <script>
      /* ========= ìœ í‹¸ ========= */
      const el = (sel) => document.querySelector(sel);
      const clamp = (v, min, max) => Math.max(min, Math.min(max, v));





      function pad2(n) { return String(n).padStart(2, '0'); }
      function labelTime(h, m) {
        const hh = ((h % 12) + 12) % 12 || 12;
        return `${hh}ì‹œ ${pad2(m)}ë¶„`; // â† í…œí”Œë¦¿ ë¦¬í„°ëŸ´ ìˆ˜ì •
      }
      function snapByDifficulty(min, diff) {
        switch (diff) {
          case 'hour': return 0;
          case 'half': return (Math.round(30 / 30) * 30) % 60; // 30 ê³ ì •
          case 'ten':  return Math.round(min / 10) * 10;
          case 'five': return Math.round(min / 5) * 5;
          case 'one':  return Math.round(min);
          default:     return Math.round(min / 5) * 5;
        }
      }
      function randomTime(diff) {
        let h = Math.floor(Math.random() * 12); // 0~11
        let m = 0;
        if (diff === 'hour') m = 0;
        else if (diff === 'half') m = 30;
        else if (diff === 'ten') m = (Math.floor(Math.random() * 6)) * 10;
        else if (diff === 'five') m = (Math.floor(Math.random() * 12)) * 5;
        else m = Math.floor(Math.random() * 60);
        return { h, m };
      }
      function minuteTolerance(diff) {
        switch (diff) {
          case 'hour': return 1; // ê±°ì˜ ì •ì‹œ
          case 'half': return 1;
          case 'ten':  return 1;
          case 'five': return 0; // 5ë¶„ ë‹¨ìœ„ëŠ” ì •í™•íˆ
          case 'one':  return 0; // 1ë¶„ ë‹¨ìœ„ëŠ” ì •í™•íˆ
          default:     return 0;
        }
      }

      /* ========= ì‹œê³„ ë Œë” ========= */
      const svg = el('#clock');
      const ticksGroup = el('#ticks');
      const minHand = el('#minuteHand');
      const hourHand = el('#hourHand');

      let state = {
        mode: 'set', // set | read
        difficulty: 'five',
        target: { h: 3, m: 0 },
        now:    { h: 3, m: 0 }, // ì‚¬ìš©ìê°€ ë§ì¶”ëŠ” í˜„ì¬ ì•„ë‚ ë¡œê·¸
        dragging: null,         // 'minute' | 'hour' | null
        stats: { correct: 0, streak: 0, best: 0 }
      };

      /* ========= ëˆˆê¸ˆ ìƒì„± (IIFE) ========= */
      (function buildTicks(){
        const cx = 100, cy = 100, rOuter = 86, rInner = 80, rHourInner = 76;
        for (let i = 0; i < 60; i++) {
          const angle = (i / 60) * 2 * Math.PI;
          const isHour = i % 5 === 0;
          const r1 = isHour ? rHourInner : rInner;
          const x1 = cx + r1 * Math.sin(angle);
          const y1 = cy - r1 * Math.cos(angle);
          const x2 = cx + rOuter * Math.sin(angle);
          const y2 = cy - rOuter * Math.cos(angle);

          const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          line.setAttribute('x1', x1); line.setAttribute('y1', y1);
          line.setAttribute('x2', x2); line.setAttribute('y2', y2);
          line.setAttribute('stroke', isHour ? '#9aa3d4' : '#4a4f77');
          line.setAttribute('stroke-width', isHour ? '2.2' : '1.1');
          ticksGroup.appendChild(line);

          if (isHour) {
            const num = (i / 5) === 0 ? 12 : i / 5;
            const rn = 66;
            const tx = cx + rn * Math.sin(angle);
            const ty = cy - rn * Math.cos(angle) + 4;

            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', tx);
            text.setAttribute('y', ty);
            text.setAttribute('fill', '#cdd2ff');
            text.setAttribute('font-size', '10');
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('font-family', 'system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif');
            text.textContent = num;
            ticksGroup.appendChild(text);
          }
        }
      })();

      /* ========= ë Œë”ë§ ========= */
      function renderHands() {
        const m = clamp(state.now.m, 0, 59);
        const h = ((state.now.h % 12) + 12) % 12;
        const minuteAngle = m * 6;              // 0..354
        const hourAngle   = h * 30 + m * 0.5;   // ì‹œì¹¨ ë³´ì •

        minHand.setAttribute('transform', `rotate(${minuteAngle} 100 100)`);
        hourHand.setAttribute('transform', `rotate(${hourAngle} 100 100)`);
      }

      /* ========= ì¢Œí‘œâ†’ê°ë„/ì‹œê°„ ë³€í™˜ ========= */
      function angleFromPoint(x, y) {
        const rect = svg.getBoundingClientRect();
        const ptX = x - rect.left;
        const ptY = y - rect.top;

        const scaleX = 200 / rect.width;
        const scaleY = 200 / rect.height;
        const sx = ptX * scaleX;
        const sy = ptY * scaleY;

        const cx = 100, cy = 100;
        let deg = Math.atan2(sx - cx, -(sy - cy)) * 180 / Math.PI;
        if (deg < 0) deg += 360;
        return deg; // 0..360
      }

      function minuteFromAngle(deg) {
        let m = Math.round(deg / 6) % 60;
        m = (m + 60) % 60;
        const diff = state.difficulty;
        if (diff === 'hour')      m = 0;
        else if (diff === 'half') m = 30;
        else if (diff === 'ten')  m = Math.round(m / 10) * 10 % 60;
        else if (diff === 'five') m = Math.round(m / 5) * 5 % 60;
        return m; // 'one'ê³¼ ê·¸ ì™¸ëŠ” ê·¸ëŒ€ë¡œ
      }

      function hourFromAngle(deg) {
        const raw = (deg / 30) % 12;
        const snapped = Math.round(raw) % 12; // ì •ìˆ˜ ì‹œë¡œ ìŠ¤ëƒ…
        return snapped;
      }

      /* ========= ë¬¸ì œ ìƒì„±/í‘œì‹œ ========= */
      function updateLabels() {
        el('#targetLabel').textContent = labelTime(state.target.h, state.target.m);
        el('#correctCount').textContent = state.stats.correct;
        el('#streak').textContent = state.stats.streak;
        el('#best').textContent = state.stats.best;
      }

      function newQuestion() {
        const diff = state.difficulty;
        state.target = randomTime(diff);

        if (state.mode === 'set') {
          const init = randomTime(diff);
          state.now.h = init.h;
          state.now.m = init.m;
        } else {
          state.now.h = state.target.h;
          state.now.m = state.target.m;
          el('#ansHour').value = '';
          el('#ansMin').value = '';
          el('#resultRead').textContent = '';
        }

        el('#resultSet').textContent = '';
        renderHands();
        updateLabels();
      }

      function loadStats() {
        try {
          const raw = localStorage.getItem('clockStats');
          if (raw) {
            const s = JSON.parse(raw);
            state.stats.correct = s.correct || 0;
            state.stats.streak  = s.streak  || 0;
            state.stats.best    = s.best    || 0;
          }
        } catch {}
      }
      function saveStats() {
        try {
          localStorage.setItem('clockStats', JSON.stringify(state.stats));
        } catch {}
      }

      /* ========= ì •ë‹µ íŒì • ========= */
      function checkSetAnswer() {
        const tol = minuteTolerance(state.difficulty);

        const targetM = state.target.m;
        const nowM = (state.difficulty === 'one' || state.difficulty === 'five' || state.difficulty === 'ten')
          ? minuteFromAngle(state.now.m * 6)
          : state.now.m;

        const th = (state.target.h % 12 + 12) % 12;
        const nh = (state.now.h % 12 + 12) % 12;

        const minuteOK = Math.abs(nowM - targetM) <= tol;
        const hourOK = nh === th;

        const resultEl = el('#resultSet');
        if (minuteOK && hourOK) {
          resultEl.textContent = 'ì •ë‹µ! ì˜í–ˆì–´ìš” ğŸ‰';
          resultEl.className = 'result ok';
          state.stats.correct += 1;
          state.stats.streak  += 1;
          state.stats.best = Math.max(state.stats.best, state.stats.streak);
          saveStats();
          updateLabels();
        } else {
          resultEl.textContent = `ì•„ì‰¬ì›Œìš”! ì •ë‹µì€ ${labelTime(state.target.h, state.target.m)} ì…ë‹ˆë‹¤.`;
          resultEl.className = 'result bad';
          state.stats.streak = 0;
          saveStats();
          updateLabels();
        }
      }

      function showSetAnswer() {
        state.now.h = state.target.h;
        state.now.m = state.target.m;
        renderHands();
      }

      function checkReadAnswer() {
        const h = parseInt(el('#ansHour').value, 10);
        const m = parseInt(el('#ansMin').value, 10);
        const resultEl = el('#resultRead');

        if (Number.isNaN(h) || Number.isNaN(m)) {
          resultEl.textContent = 'ìˆ«ìë¥¼ ì…ë ¥í•´ìš” ğŸ™‚';
          resultEl.className = 'result';
          return;
        }
        const normH = ((h % 12) + 12) % 12 || 12;
        const normT = ((state.target.h % 12) + 12) % 12 || 12;

        if (normH === normT && m === state.target.m) {
          resultEl.textContent = 'ì •ë‹µ! ğŸ‘';
          resultEl.className = 'result ok';
          state.stats.correct += 1;
          state.stats.streak  += 1;
          state.stats.best = Math.max(state.stats.best, state.stats.streak);
          saveStats();
          updateLabels();
        } else {
          resultEl.textContent = `ì•„ì‰¬ì›Œìš”! ì •ë‹µì€ ${labelTime(state.target.h, state.target.m)} ì…ë‹ˆë‹¤.`;
          resultEl.className = 'result bad';
          state.stats.streak = 0;
          saveStats();
          updateLabels();
        }
      }

      function showReadAnswer() {
        el('#ansHour').value = ((state.target.h % 12) + 12) % 12 || 12;
        el('#ansMin').value  = state.target.m;
      }

      /* ========= ë“œë˜ê·¸(í¬ì¸í„°) ========= */
      function onPointerDown(e, kind) {
        e.preventDefault();
        state.dragging = kind;
        const target = (kind === 'minute') ? minHand : hourHand;
        target.setPointerCapture?.(e.pointerId);
      }
      function onPointerMove(e) {
        if (!state.dragging) return;
        const deg = angleFromPoint(e.clientX, e.clientY);

        if (state.dragging === 'minute') {
          state.now.m = minuteFromAngle(deg);
        } else if (state.dragging === 'hour') {
          state.now.h = hourFromAngle(deg);
        }
        renderHands();
      }
      function onPointerUp() {
        if (!state.dragging) return;
        state.dragging = null;
      }

      /* ========= ì´ë²¤íŠ¸ ë°”ì¸ë”© ========= */
      minHand.addEventListener('pointerdown', (e) => onPointerDown(e, 'minute'));
      hourHand.addEventListener('pointerdown', (e) => onPointerDown(e, 'hour'));
      window.addEventListener('pointermove', onPointerMove);
      window.addEventListener('pointerup', onPointerUp);
      window.addEventListener('pointercancel', onPointerUp);

      el('#newQ').addEventListener('click', newQuestion);
      el('#checkSet').addEventListener('click', checkSetAnswer);
      el('#showAnswerSet').addEventListener('click', showSetAnswer);
      el('#checkRead').addEventListener('click', checkReadAnswer);
      el('#showAnswerRead').addEventListener('click', showReadAnswer);

      el('#mode').addEventListener('change', (e) => {
        state.mode = e.target.value;
        el('#panelSet').style.display  = (state.mode === 'set') ? '' : 'none';
        el('#panelRead').style.display = (state.mode === 'read') ? '' : 'none';
        newQuestion();
      });

      el('#difficulty').addEventListener('change', (e) => {
        state.difficulty = e.target.value;
        newQuestion();
      });


/* ========= ìŒì„± ì½ê¸°(ì•ˆì •í™”) ========= */
// í•œêµ­ì–´ ë³´ì´ìŠ¤ë¥¼ í™•ì‹¤íˆ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ìœ í‹¸
function loadVoicesOnce() {
  return new Promise((resolve) => {
    const voices = speechSynthesis.getVoices();
    if (voices && voices.length) return resolve(voices);
    // ì¼ë¶€ ë¸Œë¼ìš°ì €ëŠ” ë¹„ë™ê¸°ë¡œ ë¡œë“œë¨
    speechSynthesis.onvoiceschanged = () => resolve(speechSynthesis.getVoices());
    // iOS ì‚¬íŒŒë¦¬ ëŒ€ë¹„: resume()ë¡œ ê¹¨ìš°ê¸°
    try { speechSynthesis.resume(); } catch {}
  });
}

async function pickKoreanVoice() {
  const voices = await loadVoicesOnce();
  // ko-KR ìš°ì„ , ê·¸ ë‹¤ìŒ 'ko' í¬í•¨
  return (
    voices.find(v => v.lang?.toLowerCase() === 'ko-kr') ||
    voices.find(v => v.lang?.toLowerCase().startsWith('ko')) ||
    voices[0] // ê·¸ë˜ë„ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸
  );
}

async function speakTime() {
  if (!('speechSynthesis' in window)) {
    alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì½ê¸°ë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„ìš” ğŸ˜¢');
    return;
  }
  // í˜„ì¬ ì‹œê° ë¬¸ì¥ êµ¬ì„±
  const h = ((state.now.h % 12) + 12) % 12 || 12;
  const m = state.now.m;
  const sentence = m === 0 ? `ì§€ê¸ˆì€ ${h}ì‹œ ì •ê°ì´ì—ìš”.` : `ì§€ê¸ˆì€ ${h}ì‹œ ${m}ë¶„ì´ì—ìš”.`;

  // ë³´ì´ìŠ¤ ì„ íƒ
  const voice = await pickKoreanVoice();

  // iOS ì²« ì‹¤í–‰ ë¬´ìŒ ì´ìŠˆ ì™„í™”: ê¸°ì¡´ ìŒì„± í ì œê±° + ì•½ê°„ì˜ ì§€ì—°
  try { speechSynthesis.cancel(); } catch {}
  await new Promise(r => setTimeout(r, 50));

  const utter = new SpeechSynthesisUtterance(sentence);
  utter.lang = voice?.lang || 'ko-KR';
  utter.voice = voice || null;
  utter.rate = 0.95;   // ì•½ê°„ ëŠë¦¬ê²Œ
  utter.pitch = 1.0;

  speechSynthesis.speak(utter);
}

// ë²„íŠ¼ í•¸ë“¤ëŸ¬ ì—°ê²°(ë²„íŠ¼ì´ ëŠ¦ê²Œ ë Œë”ë¼ë„ ì•ˆì „)
(function wireReadButton(){
  const btn = document.getElementById('btnReadTime');
  if (btn) {
    btn.addEventListener('click', speakTime, { passive: true });
  } else {
    // í˜¹ì‹œ DOM ìˆœì„œë¡œ ì•„ì§ ì—†ìœ¼ë©´ DOMContentLoaded í›„ ì¬ì‹œë„
    window.addEventListener('DOMContentLoaded', () => {
      const b = document.getElementById('btnReadTime');
      if (b) b.addEventListener('click', speakTime, { passive: true });
    });
  }
})();


/* ===== ë“œë˜ê·¸(ëª¨ë°”ì¼ ì•ˆì •í™”) ===== */
let dragKind = null;
let activePointerId = null;
let tempMinute = null;  // ë“œë˜ê·¸ ì¤‘ì—ëŠ” 'ë¶€ë“œëŸ½ê²Œ' ë”°ë¼ê°€ê³ 
let tempHour = null;    // í¬ì¸í„°ë¥¼ ë–¼ëŠ” ìˆœê°„ì—ë§Œ ìŠ¤ëƒ…

function startDrag(e, kind){
  e.preventDefault();
  dragKind = kind;
  activePointerId = e.pointerId;
  const target = (kind === 'm') ? minHand : hourHand;
  if (target.setPointerCapture) target.setPointerCapture(activePointerId);
}

function moveDrag(e){
  if (!dragKind || e.pointerId !== activePointerId) return;
  e.preventDefault();
  const deg = angleFromPoint(e.clientX, e.clientY);

  if (dragKind === 'm'){
    // ì´ë™ ì¤‘ì—” 'ë¶€ë“œëŸ½ê²Œ' ê°ë„ë¡œë¶€í„° ë¶„ì„ ì‹¤ìˆ˜í˜•ìœ¼ë¡œ ê³„ì‚°í•´ì„œ í‘œì‹œë§Œ ë¶€ë“œëŸ½ê²Œ
    const raw = deg / 6;             // 0..60 float
    tempMinute = ((raw % 60) + 60) % 60;
  } else {
    const raw = deg / 30;            // 0..12 float
    tempHour = ((raw % 12) + 12) % 12;
  }
  renderHandsSmooth();
}

function endDrag(e){
  if (!dragKind || (activePointerId && e.pointerId !== activePointerId)) return;
  // í¬ì¸í„° í•´ì œ
  if (minHand.releasePointerCapture) {
    try { minHand.releasePointerCapture(activePointerId); } catch {}
    try { hourHand.releasePointerCapture(activePointerId); } catch {}
  }
  activePointerId = null;

  // ì—¬ê¸°ì„œë§Œ ìŠ¤ëƒ… ì ìš© (5ë¶„/ì •ì‹œ ë“±)
  if (dragKind === 'm'){
    const snapped =
      (state.difficulty === 'hour') ? 0 :
      (state.difficulty === 'half') ? 30 :
      (state.difficulty === 'ten')  ? Math.round(tempMinute/10)*10 % 60 :
      (state.difficulty === 'five') ? Math.round(tempMinute/5)*5 % 60 :
                                      Math.round(tempMinute) % 60;
    state.now.m = snapped;
    tempMinute = null;
  } else {
    state.now.h = Math.round(tempHour) % 12;
    tempHour = null;
  }
  dragKind = null;
  renderHands(); // ìµœì¢… ìŠ¤ëƒ…ëœ ê°’ìœ¼ë¡œ ê·¸ë¦¬ê¸°
}

/* ë¦¬ìŠ¤ë„ˆ â€“ ë°˜ë“œì‹œ passive:false */
minHand.addEventListener('pointerdown', e => startDrag(e, 'm'), { passive: false });
hourHand.addEventListener('pointerdown', e => startDrag(e, 'h'), { passive: false });
window.addEventListener('pointermove', moveDrag, { passive: false });
window.addEventListener('pointerup', endDrag, { passive: false });
window.addEventListener('pointercancel', endDrag, { passive: false });

/* ë¶€ë“œëŸ¬ìš´ ì‹¤ì‹œê°„ ë Œë”(ë“œë˜ê·¸ ì¤‘) */
function renderHandsSmooth(){
  // ë¶„ì¹¨
  const m = (tempMinute != null) ? tempMinute : state.now.m;
  const h = (tempHour   != null) ? tempHour   : (state.now.h % 12);
  const minuteAngle = m * 6;            // ì‹¤ìˆ˜ ê°ë„ OK
  const hourAngle   = h * 30 + (m * 0.5);

  minHand.setAttribute('transform', `rotate(${minuteAngle} 100 100)`);
  hourHand.setAttribute('transform', `rotate(${hourAngle} 100 100)`);
}

let startX=0, startY=0;
function startDrag(e, kind){
  e.preventDefault();
  startX = e.clientX; startY = e.clientY;
  dragKind = kind; activePointerId = e.pointerId;
  const t = (kind === 'm') ? minHand : hourHand;
  t.setPointerCapture?.(activePointerId);
}
function moveDrag(e){
  if (!dragKind || e.pointerId !== activePointerId) return;
  const dx = e.clientX - startX, dy = e.clientY - startY;
  if ((dx*dx + dy*dy) < 25) { e.preventDefault(); return; } // 5px ë°ë“œì¡´
  // (ì´í•˜ ë™ì¼)
}



      /* ========= ì´ˆê¸°í™” ========= */
      loadStats();
      renderHands();
      updateLabels();
      newQuestion();
    </script>
  </body>
</html>
